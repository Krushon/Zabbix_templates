# Zabbix-VPN-Templates
Шаблоны и скрипты мониторинга vpn-подключений.

*Основа шаблона, скрипта, конфига и вдохновения взята с [serveradmin.ru](https://serveradmin.ru/monitoring-openvpn-podklyucheniy-polzovateley-v-zabbix/). Исправил ошибки и переделал под собственные нужды - сам.*

**Список шаблонов:**
1. *Template_App_OpenVPN.xml* - основной шаблон для мониторинга.


**Информация о выводах в шаблонах**
1. Элементы для мониторинга за полученным и переданным трафиком пользователя.
2. Элементы для мониторинга за статусом подключения, отключения пользователя.
3. Триггер со срабатыванием на подключение и отключение пользователя.
4. График полученных, отправленных данных в байтах.
5. График со статусом подключения пользователя.
6. Количество подключенных пользователей к openvpn-серверу.

**Установка и настройка**
1. На машине с openvpn и настроенным zabbix-agent сохраняем скрипт *discover_vpn.sh* в папку **/etc/zabbix/scripts** (если папки нет - создаём) и даём ему права на запуск.<br>
`# chown zabbix. discover_vpn.sh && chmod +x discover_vpn.sh`<br>
*По необходимости нужно исправить путь до директории ccd, заданный в конфиге openvpn параметром client-config-dir*

2. Сохраняем конфиг *openvpn.conf* в папку **/etc/zabbix/zabbix_agent.d/**.<br>
*По необходимости нужно исправить путь до файла openvpn-status.log*
<br> Нужно дать права на openvpn-status.log заббиксу на чтение.<br>
`# chmod 644 /etc/openvpn/openvpn-status.log`<br>

3. Перезапускаем агента<br>
`# systemctl restart zabbix-agent`

4. Импортируем шаблон *Template_App_OpenVPN.xml* в zabbix-server, создаём хост и привязываемся к шаблону.
