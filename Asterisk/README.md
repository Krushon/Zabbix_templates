# Zabbix-Asterisk-Templates
Шаблоны и скрипты мониторинга Asterisk по iax2-транкам для Zabbix 4.2.

*Основа шаблона, скрипта, конфига и вдохновения взята с [serveradmin.ru](https://serveradmin.ru/monitoring-asterisk-v-zabbix). Исправил ошибки и переделал под собственные нужды - сам.*

**Список шаблонов:**
1. *Template_Asterisk_iax2.xml* - основной шаблон для мониторинга по iax2.


**Информация о выводах в шаблонах**
1. Время работы Asterisk (uptime).<br>
1.1. Триггер на перезагрузку.
2. Текущие вызовы.
3. Работа службы Asterisk (работает или нет).<br>
3.1. Триггер на down.
4. Работа транков (онлайн/оффлайн).<br>
4.1. Триггер на оффлайн-транк с его названием.
5. Работа fail2ban.<br>
5.1. Триггеры на down и inactive.

**Установка и настройка**
1. Импортируем шаблон *Template_Asterisk_iax2.xml* в zabbix-server, создаём хост и привязываемся к шаблону.
2. На машине с asterisk и настроенным zabbix-agent сохраняем скрипт *asterisk.trunk-with-name.sh* в папку **/etc/zabbix/scripts** (если папки нет - создаём). Даём скрипту права на запуск.
3. Сохраняем конфиг *asterisk.conf* в папку **/etc/zabbix/zabbix_agent.d/**.<br>
3.1. Если fail2ban в системе не используется, то строчки 2 и 4 можно закомментить, а на сервере отключить соответствующие элементы шаблона у хоста.<br>
3.2. "Скажу честно, мне было лениво разбираться с разрешениями и я просто запустил zabbix с правами root. Для этого в его конфиге /etc/zabbix/zabbix_agentd.conf раскомментировал следующую строку: 
`AllowRoot=1`"
4. Перезапускаем агента<br>
`# systemctl restart zabbix-agent`